# Способы выхода из горутины

## Канал отмены (cancel channel)

Канал отмены используется для того, чтобы сигнализировать горутине, что пора завершить работу. Это нужно например для того, чтобы горутина не зависла навсегда в заблокированном состоянии

```
func rangeGenerator(cancel <-chan struct{}, start, stop int) <-chan int {
	out := make(chan int)
	go func() {
		defer close(out)
		for i := start; i < stop; i++ {
			select {
			case out <- i:  // (1)
			case <-cancel:  // (2)
				return
			}
		}
	}()
	return out
}
```

Стоит здесь обратить внимание на работу `select`:

1. Проверяет, какие ветки (case) не заблокированы
2. Если таких несколько, то выбирает одну из них случайным образом и выполняет
3. Если все ветки заблокированы, блокирует выполнение, пока хотя бы одна ветка не разблокируется

В примере выше:
- Пока `cancel` открыт, его ветка (2) заблокирована (невозможно прочитать из канала, в который никто не пишет). При этом ветка (1) `out <- i` разблокирована, т.к. из канала читают значения.
- Как только из `out` перестанут читать, то заблокируются обе ветки.
- Как только канал отмены закроется, в `select` разблокируется ветка (2) и горутина завершит свою работу.

## Объединение каналов (merge channels)

TODO...

## Ограничитель скорости (rate limiter)

TODO...
